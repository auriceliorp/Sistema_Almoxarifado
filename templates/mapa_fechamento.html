{% extends 'base_simplificada.html' %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Mapa de Fechamento Mensal</h2>

  <!-- CABEÇALHO COM AÇÕES -->
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
    <a href="{{ url_for('main.home') }}" class="btn btn-outline-primary">
      <i class="bi bi-house-door"></i> Início
    </a>
    <a href="{{ url_for('relatorio_bp.mapa_fechamento') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left-circle"></i> Voltar
    </a>
    <div class="d-flex gap-2">
      <a href="{{ url_for('relatorio_bp.imprimir_mapa_fechamento', mes=mes, ano=ano) }}" class="btn btn-outline-info">
        <i class="bi bi-printer"></i> Imprimir
      </a>
      <a href="{{ url_for('relatorio_bp.exportar_mapa_excel', mes=mes, ano=ano) }}" class="btn btn-outline-success">
        <i class="bi bi-file-earmark-excel"></i> Excel
      </a>
      <a href="{{ url_for('relatorio_bp.exportar_pdf', mes=mes, ano=ano) }}" class="btn btn-outline-danger">
        <i class="bi bi-file-earmark-pdf"></i> PDF
      </a>
    </div>
  </div>

  <!-- FILTROS -->
  <form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
      <label for="mes" class="form-label">Mês:</label>
      <select id="mes" name="mes" class="form-select" required>
        {% for m in range(1, 13) %}
        <option value="{{ m }}" {% if m == mes %}selected{% endif %}>{{ '{:02d}'.format(m) }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label for="ano" class="form-label">Ano:</label>
      <select id="ano" name="ano" class="form-select" required>
        {% for a in anos_disponiveis %}
        <option value="{{ a }}" {% if a == ano %}selected{% endif %}>{{ a }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button type="submit" class="btn btn-primary">Filtrar</button>
    </div>
  </form>

  <!-- TABELA -->
  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>Natureza de Despesa</th>
        <th>Saldo Inicial</th>
        <th>Entradas</th>
        <th>Saídas</th>
        <th>Saldo Final</th>
      </tr>
    </thead>
    <tbody>
      {% for linha in relatorio %}
      <tr>
        <td>{{ linha.nd.codigo }} - {{ linha.nd.nome }}</td>
        <td>{{ '%.2f'|format(linha.inicial) }}</td>
        <td>{{ '%.2f'|format(linha.entrada) }}</td>
        <td>{{ '%.2f'|format(linha.saida) }}</td>
        <td>{{ '%.2f'|format(linha.final) }}</td>
      </tr>
      {% else %}
      <tr>
        <td colspan="5" class="text-center">Nenhum dado encontrado para o período selecionado.</td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot class="table-light fw-bold">
      <tr>
        <td>Total</td>
        <td>{{ '%.2f'|format(total_saldo_inicial) }}</td>
        <td>{{ '%.2f'|format(total_entradas) }}</td>
        <td>{{ '%.2f'|format(total_saidas) }}</td>
        <td>{{ '%.2f'|format(total_saldo_final) }}</td>
      </tr>
    </tfoot>
  </table>
</div>
{% endblock %}