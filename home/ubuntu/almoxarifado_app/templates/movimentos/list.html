{% extends "base.html" %}

{% block title %}Movimentos de Estoque - Almoxarifado{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Histórico de Movimentos de Estoque</h2>
    <a href="{{ url_for("main.registrar_movimento") }}" class="btn btn-success">+ Registrar Movimento</a>
</div>

{# TODO: Adicionar filtros (por item, tipo, data, usuário) #}

{% if movimentos %}
<table class="table table-striped table-hover table-sm">
    <thead>
        <tr>
            <th scope="col">Data/Hora</th>
            <th scope="col">Item</th>
            <th scope="col">Tipo</th>
            <th scope="col">Quantidade</th>
            <th scope="col">Saldo Anterior</th>
            <th scope="col">Saldo Posterior</th>
            <th scope="col">Usuário</th>
            <th scope="col">Observação</th>
            <th scope="col">Ref. Requisição</th>
        </tr>
    </thead>
    <tbody>
        {% for mov in movimentos %}
        <tr>
            <td>{{ mov.data_movimento.strftime("%d/%m/%Y %H:%M:%S") if mov.data_movimento else "" }}</td>
            <td>{{ mov.item.nome if mov.item else "N/A" }}</td>
            <td>
                {% if mov.tipo == "ENTRADA" %}
                    <span class="badge bg-success">Entrada</span>
                {% elif mov.tipo == "SAIDA_REQUISICAO" %}
                    <span class="badge bg-danger">Saída (Requisição)</span>
                {% elif mov.tipo == "SAIDA_AJUSTE" %}
                    <span class="badge bg-warning text-dark">Saída (Ajuste)</span>
                {% elif mov.tipo == "ENTRADA_AJUSTE" %}
                    <span class="badge bg-info text-dark">Entrada (Ajuste)</span>
                {% elif mov.tipo == "INVENTARIO_INICIAL" %}
                    <span class="badge bg-primary">Inventário Inicial</span>
                {% else %}
                    {{ mov.tipo }}
                {% endif %}
            </td>
            <td>{{ mov.quantidade }}</td>
            <td>{{ mov.saldo_anterior }}</td>
            <td>{{ mov.saldo_posterior }}</td>
            <td>{{ mov.registrado_por.nome if mov.registrado_por else "N/A" }}</td>
            <td>{{ mov.observacao }}</td>
            <td>
                {% if mov.requisicao_item_associado %}
                    <a href="{{ url_for("main.detalhes_requisicao", id=mov.requisicao_item_associado.requisicao_id) }}">Req. {{ mov.requisicao_item_associado.requisicao_id }}</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{# TODO: Adicionar Paginação #}

{% else %}
<div class="alert alert-info" role="alert">
    Nenhum movimento de estoque registrado ainda.
</div>
{% endif %}

{% endblock %}

