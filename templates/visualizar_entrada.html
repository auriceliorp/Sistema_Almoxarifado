{% extends 'base_simplificada.html' %}

{% block content %}
<div class="container mt-4">

  {# ---------------------- Cabeçalho da página ---------------------- #}
  <h2>Visualizar Entrada de Materiais</h2>

  {# ---------------------- Bloco de dados principais da entrada ---------------------- #}
  <div class="card my-4">
    <div class="card-body">
      <p><strong>Data do Movimento:</strong> {{ entrada.data_movimento.strftime('%d/%m/%Y') }}</p>
      <p><strong>Data da Nota Fiscal:</strong> {{ entrada.data_nota_fiscal.strftime('%d/%m/%Y') }}</p>
      <p><strong>Número da Nota Fiscal:</strong> {{ entrada.numero_nota_fiscal }}</p>
      <p><strong>Fornecedor:</strong> {{ entrada.fornecedor.nome }}</p>
      <p><strong>Registrado por:</strong> {{ entrada.usuario.nome }}</p>
    </div>
  </div>

  {# ---------------------- Tabela de itens da entrada ---------------------- #}
  <h4>Itens da Entrada</h4>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantidade</th>
        <th>Valor Unitário (R$)</th>
        <th>Total (R$)</th>
      </tr>
    </thead>
    <tbody>
      {% for item in itens %}
      <tr>
        <td>{{ item.item.nome }}</td>
        <td>{{ item.quantidade }}</td>
        <td>{{ '%.2f' | format(item.valor_unitario) }}</td>
        <td>{{ '%.2f' | format(item.quantidade * item.valor_unitario) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {# ---------------------- Botões de ação ---------------------- #}
  <div class="mt-4 d-flex justify-content-between">

    {# Botão para voltar à lista de entradas #}
    <a href="{{ url_for('entrada_bp.lista_entradas') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Voltar
    </a>

    {# Botão de estorno com método POST e parâmetro correto (entrada_id) #}
    <form action="{{ url_for('entrada_bp.estornar_entrada', entrada_id=entrada.id) }}" method="post" class="d-inline">
      <button type="submit" class="btn btn-outline-danger"
              onclick="return confirm('Confirmar estorno desta entrada?')">
        <i class="bi bi-arrow-counterclockwise"></i> Estornar Entrada
      </button>
    </form>

  </div>
</div>
{% endblock %}