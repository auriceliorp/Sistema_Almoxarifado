{% extends "base.html" %}

{% block title %}Requisições - Almoxarifado{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Requisições Internas</h2>
    {# TODO: Verificar permissão para criar (Solicitante) #}
    <a href="{{ url_for("main.criar_requisicao") }}" class="btn btn-success">+ Nova Requisição</a>
</div>

{# TODO: Adicionar filtros (status, solicitante, data) #}

{% if requisicoes %}
<table class="table table-striped table-hover table-sm">
    <thead>
        <tr>
            <th scope="col">ID</th>
            <th scope="col">Data</th>
            <th scope="col">Solicitante</th>
            <th scope="col">Status</th>
            <th scope="col">Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for req in requisicoes %}
        <tr>
            <td>{{ req.id }}</td>
            <td>{{ req.data_requisicao.strftime("%d/%m/%Y %H:%M") if req.data_requisicao else "" }}</td>
            <td>{{ req.solicitante.nome if req.solicitante else "N/A" }}</td>
            <td>
                {% if req.status == "PENDENTE" %}
                    <span class="badge bg-warning text-dark">Pendente</span>
                {% elif req.status == "APROVADA" %}
                    <span class="badge bg-info text-dark">Aprovada</span>
                {% elif req.status == "REJEITADA" %}
                    <span class="badge bg-danger">Rejeitada</span>
                {% elif req.status == "ATENDIDA_PARCIAL" %}
                    <span class="badge bg-primary">Atendida Parcialmente</span>
                {% elif req.status == "ATENDIDA_TOTAL" %}
                    <span class="badge bg-success">Atendida Totalmente</span>
                {% elif req.status == "CANCELADA" %}
                    <span class="badge bg-secondary">Cancelada</span>
                {% else %}
                    {{ req.status }}
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for("main.detalhes_requisicao", id=req.id) }}" class="btn btn-sm btn-outline-info">Ver Detalhes</a>
                {# Adicionar outras ações rápidas se necessário (ex: Cancelar se pendente e dono) #}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{# TODO: Adicionar Paginação #}

{% else %}
<div class="alert alert-info" role="alert">
    Nenhuma requisição encontrada.
</div>
{% endif %}

{% endblock %}

