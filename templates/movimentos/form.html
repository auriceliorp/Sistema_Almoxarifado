{% extends "base.html" %}

{% block title %}Registrar Movimento de Estoque - Almoxarifado{% endblock %}

{% block content %}
<h2>Registrar Movimento de Estoque</h2>
<p class="text-muted">Use este formulário para registrar entradas manuais, saídas por ajuste ou definir o inventário inicial de um item.</p>

{# Usa form_data se houver erro e estiver recarregando #}
{% set current_data = form_data if form_data else {} %}

<form method="POST" action="{{ url_for("main.registrar_movimento") }}">
    <div class="row g-3">
        <div class="col-md-6">
            <label for="item_id" class="form-label">Item <span class="text-danger">*</span></label>
            <select class="form-select" id="item_id" name="item_id" required>
                <option value="" {% if not current_data.get("item_id") %}selected{% endif %} disabled>Selecione o item...</option>
                {% for item in itens %}
                    <option value="{{ item.id }}" {% if current_data.get("item_id") == item.id|string %}selected{% endif %}>
                        {{ item.nome }} (Saldo Atual: {{ item.saldo_atual }} {{ item.unidade_medida }})
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-6">
            <label for="tipo" class="form-label">Tipo de Movimento <span class="text-danger">*</span></label>
            <select class="form-select" id="tipo" name="tipo" required>
                <option value="" {% if not current_data.get("tipo") %}selected{% endif %} disabled>Selecione o tipo...</option>
                <option value="ENTRADA" {% if current_data.get("tipo") == "ENTRADA" %}selected{% endif %}>Entrada</option>
                <option value="SAIDA_AJUSTE" {% if current_data.get("tipo") == "SAIDA_AJUSTE" %}selected{% endif %}>Saída (Ajuste)</option>
                <option value="ENTRADA_AJUSTE" {% if current_data.get("tipo") == "ENTRADA_AJUSTE" %}selected{% endif %}>Entrada (Ajuste)</option>
                <option value="INVENTARIO_INICIAL" {% if current_data.get("tipo") == "INVENTARIO_INICIAL" %}selected{% endif %}>Inventário Inicial</option>
                {# SAIDA_REQUISICAO é gerada automaticamente #}
            </select>
        </div>

        <div class="col-md-4">
            <label for="quantidade" class="form-label">Quantidade <span class="text-danger">*</span></label>
            <input type="number" class="form-control" id="quantidade" name="quantidade" value="{{ current_data.get("quantidade", "") }}" required min="1">
        </div>

        <div class="col-md-8">
            <label for="observacao" class="form-label">Observação</label>
            <input type="text" class="form-control" id="observacao" name="observacao" value="{{ current_data.get("observacao", "") }}" maxlength="255">
        </div>
    </div>

    <hr class="my-4">

    <a href="{{ url_for("main.listar_movimentos") }}" class="btn btn-secondary">Cancelar</a>
    <button type="submit" class="btn btn-primary">Registrar Movimento</button>
</form>

{% endblock %}

